<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Step 2 : build a Runge-Kutta type time-stepper &mdash; QMat Package  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=61a4c737" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=2e11fc30" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Step 3 : generate \(Q_\Delta\) coefficients" href="03_qDelta.html" />
    <link rel="prev" title="Step 1 : generate \(Q\)-coefficients" href="01_qCoeffs.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            QMat Package
              <img src="../_static/sdc_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installing QMat</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="README.html">Notebook Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="README.html#base-usage">Base usage</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01_qCoeffs.html">Step 1 : generate <span class="math notranslate nohighlight">\(Q\)</span>-coefficients</a><ul>
<li class="toctree-l4"><a class="reference internal" href="01_qCoeffs.html#Use-a-generic-function">Use a generic function</a></li>
<li class="toctree-l4"><a class="reference internal" href="01_qCoeffs.html#Use-generator-objects">Use generator objects</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Step 2 : build a Runge-Kutta type time-stepper</a></li>
<li class="toctree-l3"><a class="reference internal" href="03_qDelta.html">Step 3 : generate <span class="math notranslate nohighlight">\(Q_\Delta\)</span> coefficients</a><ul>
<li class="toctree-l4"><a class="reference internal" href="03_qDelta.html#Procedural-approach-:-use-a-generic-function">Procedural approach : use a generic function</a></li>
<li class="toctree-l4"><a class="reference internal" href="03_qDelta.html#OOP-approach-:-use-generator-objects">OOP approach : use generator objects</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="04_sdc.html">Step 4 : build a Spectral Deferred Correction type time-stepper</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="README.html#advanced-usage">Advanced usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="11_prolongation.html">Step 5 : generalizing the prolongation for RK-type and SDC-type time-steppers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="11_prolongation.html#Additional-coefficients-from-G-generators">Additional coefficients from <span class="math notranslate nohighlight">\(G\)</span>-generators</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="12_initialization.html">Step 6 : generalizing the initialization of SDC-type time-steppers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#general-rules">General rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#base-recipes">Base recipes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../devdoc/testing.html">Testing your changes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/qmat/index.html">QMat API reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../autoapi/qmat/index.html#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/qmat/qcoeff/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">qmat.qcoeff</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/qmat/qcoeff/index.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/qmat/qdelta/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">qmat.qdelta</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/qmat/qdelta/index.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../autoapi/qmat/index.html#submodules">Submodules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/qmat/lagrange/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">qmat.lagrange</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/qmat/lagrange/index.html#module-contents">Module Contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/qmat/nodes/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">qmat.nodes</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/qmat/nodes/index.html#module-contents">Module Contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/qmat/sdc/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">qmat.sdc</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/qmat/sdc/index.html#module-contents">Module Contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/qmat/utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">qmat.utils</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/qmat/utils/index.html#module-contents">Module Contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../autoapi/qmat/index.html#package-contents">Package Contents</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">QMat Package</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="README.html">Notebook Tutorials</a></li>
      <li class="breadcrumb-item active">Step 2 : build a Runge-Kutta type time-stepper</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/02_rk.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Step-2-:-build-a-Runge-Kutta-type-time-stepper">
<h1>Step 2 : build a Runge-Kutta type time-stepper<a class="headerlink" href="#Step-2-:-build-a-Runge-Kutta-type-time-stepper" title="Link to this heading">ÔÉÅ</a></h1>
<p>üìú <em>Once obtained the following</em> <span class="math notranslate nohighlight">\(Q\)</span><em>-coefficients :</em></p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}
    {c|c}
    \tau &amp; Q \\
    \hline
    &amp; w^\top
\end{array}\end{split}\]</div>
<p><em>we can use those to build the associated time-stepping scheme and solve time-dependent problems.</em></p>
<blockquote>
<div><p>üì£ Remember, this is exactly the same as Butcher tables for a Runge-Kutta method ‚Ä¶</p>
</div></blockquote>
<p>Consider the following simple ODE, usually named <em>Dahlquist problem</em> :</p>
<div class="math notranslate nohighlight">
\[\frac{du}{dt} = \lambda u, \quad t \in [0, T], \quad u(0)=u_0.\]</div>
<p>We choose here <span class="math notranslate nohighlight">\(\lambda=i\)</span> (imaginary unit), <span class="math notranslate nohighlight">\(T=4\pi\)</span>, and <span class="math notranslate nohighlight">\(u_0=e^{\frac{i\pi}{6}}\)</span> :</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">lam</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">u0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let say we want to solve it numerically, using <span class="math notranslate nohighlight">\(12\)</span> time-steps of the famous RK4 method. This is how we do it with <code class="docutils literal notranslate"><span class="pre">qmat</span></code> :</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qmat</span> <span class="kn">import</span> <span class="n">Q_GENERATORS</span>

<span class="n">rk</span> <span class="o">=</span> <span class="n">Q_GENERATORS</span><span class="p">[</span><span class="s2">&quot;RK4&quot;</span><span class="p">]()</span>
<span class="n">nodes</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">Q</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">genCoeffs</span><span class="p">()</span>

<span class="n">nSteps</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">uNum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nSteps</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">uNum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">u0</span>

<span class="n">dt</span> <span class="o">=</span> <span class="n">T</span><span class="o">/</span><span class="n">nSteps</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">-</span> <span class="n">lam</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">Q</span>  <span class="c1"># all-at-once system</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nSteps</span><span class="p">):</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">*</span><span class="n">uNum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># ... with its RHS</span>
    <span class="n">uNodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>   <span class="c1"># ... and its solution</span>
    <span class="n">uNum</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">uNum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">lam</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">weights</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">uNodes</span><span class="p">)</span>  <span class="c1"># prolongation</span>
<br/></pre></div>
</div>
</div>
<p>To explain a bit, we simply computed <span class="math notranslate nohighlight">\(N=12\)</span> time-step solutions <span class="math notranslate nohighlight">\(u_1:=u(t_1), \dots, u_n:=u(t_n) \dots, u_{N}:=u(t_N)=u(T)\)</span>, with <span class="math notranslate nohighlight">\(t_{n+1}-t_{n} = \Delta{t} = T/N\)</span>. One time-step consists on :</p>
<ol class="arabic simple">
<li><p>solving the <strong>all-at-once system</strong> :</p></li>
</ol>
<div class="math notranslate nohighlight">
\[(I - \lambda\Delta{t} Q) u_\tau = [u_n, \dots, u_n]^T,\]</div>
<p>where <span class="math notranslate nohighlight">\(u_\tau\)</span> stores the numerical approximation at <span class="math notranslate nohighlight">\(t_n + \Delta{t}\tau_m\)</span>, also called the <strong>nodes solution</strong> (for collocation methods) or <strong>stage solutions</strong> (for RK methods).</p>
<ol class="arabic simple" start="2">
<li><p>updating the step solution with the <strong>prolongation</strong> :</p></li>
</ol>
<div class="math notranslate nohighlight">
\[u_{n+1} = u_{n} + \lambda\Delta{t} w^T u_\tau\]</div>
<p>And that‚Äôs it, independent on the fact that we are using the RK4 scheme, or whatever else ‚Ä¶ We show the solution below, along with the exact analytic solution in dashed line :</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">uNum</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">uNum</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>

<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">nSteps</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">uExact</span> <span class="o">=</span> <span class="n">u0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lam</span><span class="o">*</span><span class="n">times</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">uExact</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">uExact</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_02_rk_6_0.png" src="../_images/notebooks_02_rk_6_0.png" />
</div>
</div>
<p>As expected, we can observe some numerical error of the time-scheme, since we do not retrieve exactly the hexagon showed by the exact solution.</p>
<p>One error indicator is the <span class="math notranslate nohighlight">\(L_\infty\)</span> error on all time-steps :</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;L_inf error : </span><span class="si">{:1.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">uNum</span><span class="o">-</span><span class="n">uExact</span><span class="p">,</span> <span class="nb">ord</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
L_inf error : 0.11925
</pre></div></div>
</div>
<p>Now let say we want to use a collocation method instead of RK4, using <span class="math notranslate nohighlight">\(4\)</span> Legendre Radau-II nodes (<em>i.e</em> Radau nodes including the right time interval bound). The only line we have to change in the previous code is :</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">coll</span> <span class="o">=</span> <span class="n">Q_GENERATORS</span><span class="p">[</span><span class="s2">&quot;coll&quot;</span><span class="p">](</span><span class="n">nNodes</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">nodeType</span><span class="o">=</span><span class="s2">&quot;LEGENDRE&quot;</span><span class="p">,</span> <span class="n">quadType</span><span class="o">=</span><span class="s2">&quot;RADAU-RIGHT&quot;</span><span class="p">)</span>
<span class="c1"># then use coll instead of rk in the previous code ...</span>
</pre></div>
</div>
</div>
<p>Then the <strong>exact same code as before</strong> can be used to build the time-stepper, compute the numerical solution and the error.</p>
<p>But in practice, you don‚Äôt have to, as the <span class="math notranslate nohighlight">\(Q\)</span>-generators in <code class="docutils literal notranslate"><span class="pre">qmat</span></code> already provide dedicated methods for that :</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">uNum</span> <span class="o">=</span> <span class="n">coll</span><span class="o">.</span><span class="n">solveDahlquist</span><span class="p">(</span><span class="n">lam</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">nSteps</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">uNum</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">uNum</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;L_inf error : </span><span class="si">{:1.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">coll</span><span class="o">.</span><span class="n">errorDahlquist</span><span class="p">(</span><span class="n">lam</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">nSteps</span><span class="p">,</span> <span class="n">uNum</span><span class="o">=</span><span class="n">uNum</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
L_inf error : 0.00001
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_02_rk_12_1.png" src="../_images/notebooks_02_rk_12_1.png" />
</div>
</div>
<p>This time it‚Äôs way more accurate, even if we used <span class="math notranslate nohighlight">\(Q\)</span>-coefficients of the same size ‚Ä¶ but there is a major difference here between the two <span class="math notranslate nohighlight">\(Q\)</span> matrices :</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Q for RK4 :&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rk</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Q for Collocation :&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">coll</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Q for RK4 :
[[0.  0.  0.  0. ]
 [0.5 0.  0.  0. ]
 [0.  0.5 0.  0. ]
 [0.  0.  1.  0. ]]
Q for Collocation :
[[ 0.11299948 -0.04030922  0.02580238 -0.00990468]
 [ 0.234384    0.20689257 -0.04785713  0.01604742]
 [ 0.21668178  0.40612326  0.18903652 -0.0241821 ]
 [ 0.22046221  0.38819347  0.32884432  0.0625    ]]
</pre></div></div>
</div>
<p>While <span class="math notranslate nohighlight">\(Q\)</span> is dense for the collocation method, it is not (and actually lower triangular) for RK4. Hence in practice, solving the <strong>all-at-once system</strong> with the collocation method is the most expensive, as we need to solve it ‚Ä¶ well, <em>all-at-once</em>.</p>
<blockquote>
<div><p>üîç In this case (Dahlquist), it is quite easy and cheap as showed above. But for large scale non-linear problems, this can quickly become unfeasible, as each time node may represent thousands or millions of degrees of freedom ‚Ä¶</p>
</div></blockquote>
<p>For RK4 though, it is much more simpler : on simply need to solve the first node solution (explicit expression for RK4 since the diagonal coefficient is 0), then use it to solve the second node solution, etc ‚Ä¶ so no need to solve the system all-at-once ! This is one reason why RK methods have been generally favored in scientific computing against collocation methods.</p>
<blockquote>
<div><p>üîî However, the high accuracy of collocation methods motivates to estimate the all-at-once solution in a cheaper way than a direct solve.</p>
</div></blockquote>
<p>This is the main idea of Spectral Deferred Correction (SDC) and Iterated Runge-Kutta methods, which use fixed-point preconditioned iterations to solve the all-at-once system. The preconditoner is then built using a <strong>lower triangular</strong> approximation of the <span class="math notranslate nohighlight">\(Q\)</span> matrix, named the <span class="math notranslate nohighlight">\(Q_\Delta\)</span> matrix.</p>
<p>Those can be generated using the second main feature of <code class="docutils literal notranslate"><span class="pre">qmat</span></code>, see the <a class="reference internal" href="03_qDelta.html"><span class="doc">next tutorial ‚Ä¶</span></a></p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="01_qCoeffs.html" class="btn btn-neutral float-left" title="Step 1 : generate \(Q\)-coefficients" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="03_qDelta.html" class="btn btn-neutral float-right" title="Step 3 : generate \(Q_\Delta\) coefficients" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024 PinT Community.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>